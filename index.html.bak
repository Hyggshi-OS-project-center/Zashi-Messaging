<body>
  <h1>Zashi Messaging</h1>

  <div id="login">
    <input id="username" placeholder="Nhập tên của bạn...">
    <button onclick="login()">Vào Chat</button>
  </div>

  <div id="chatbox" style="display: none;">
    <div id="chat"></div>
    <input id="msg" placeholder="Nhập tin nhắn...">
    <button onclick="send()">Gửi</button>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    let socket;
    let username = '';

    function login() {
      username = document.getElementById('username').value.trim();
      if (username) {
        socket = io({ query: { username } });
        document.getElementById('login').style.display = 'none';
        document.getElementById('chatbox').style.display = 'block';

        socket.on('newMessage', (data) => {
          addMessage(data.username, data.message);
        });

        socket.on('loadMessages', (msgs) => {
          msgs.forEach((data) => addMessage(data.username, data.message));
        });
      }
    }

    function addMessage(user, msg) {
      const chat = document.getElementById('chat');
      const div = document.createElement('div');
      div.textContent = `${user}: ${msg}`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function send() {
      const input = document.getElementById('msg');
      const msg = input.value.trim();
      if (msg) {
        socket.emit('sendMessage', msg);
        input.value = '';
      }
    }
  </script>
</body>
